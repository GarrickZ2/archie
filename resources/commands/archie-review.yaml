title: Review
description: Clarify requirements and dependencies to complete the feature review
tags: [review, requirements, dependencies]
category: Archie
content: |
  ## Purpose
  Clarify requirements and dependencies, eliminate ambiguity. Produce a review-complete feature document and either unblock it or explicitly block it with tracked blockers.

  ---

  ## Allowed Status

  - `NOT_REVIEWED`
  - `UNDER_REVIEW`
  - `BLOCKED`

  ---

  ## Reads

  - `background.md`
  - `features/<feature-key>.md`
  - `dependency.md`
  - `faq.md`
  - `blocker.md`

  ---

  ## Writes

  - `features/<feature-key>.md`
  - `faq.md`
  - `blocker.md`
  - `dependency.md`

  ---

  ## Required Outputs

  - `features/<feature-key>.md` must contain complete: Summary, Scope, Requirements, Dependencies, Acceptance Criteria
  - Dependencies must be: explicitly named, validated against `dependency.md`, annotated with interaction type
  - All uncertainties must be recorded in: `faq.md` (answered questions), `blocker.md` (unresolved issues)
  - Status transition: any unchecked blocker → `BLOCKED`, else → `READY_FOR_DESIGN`

  ---

  ## Dependency Review Rules (Hard Gate)

  During review, the agent **must**:

  1. **Discover dependencies** - Infer upstreams/downstreams. No feature may have empty Dependencies section unless justified.
  2. **Validate against `dependency.md`** - Reference existing dependencies by name. Create minimal stubs for missing ones.
  3. **Clarify critical attributes** - Determine owner/team, interface type, stability/SLA, constraints for each dependency.
  4. **Block if unclear** - If any required dependency attribute is unknown and blocks design, create blocker and keep status `BLOCKED`.

  ---

  ## Correction Behavior

  If the feature file does not exist:
  - Refuse `review`
  - Instruct the user to create the feature via `init` (or `revise` to scaffold) first.

  ---

  ## Prompt Skeleton (Orchestrator)

  **Goal:** Make the feature *review-complete* with dependency clarity and minimal user Q&A.

  **Steps:**

  1. Load `background.md` hard rules; reject conflicting requirements.
  2. **Feature selection phase** - If no feature-key provided: read `features/README.md` and recommend the most ready-to-review feature based on status, dependencies, and blockers.
  3. Parse feature document; identify missing or ambiguous sections.
  4. **Dependency discovery phase** - Extract upstreams/downstreams, validate against `dependency.md`, create stubs for missing dependencies.
  5. Ask the **minimum** questions required (dependency unknowns, acceptance criteria ambiguity).
  6. Write answered questions to `faq.md` (append-only).
  7. Write unresolved items to `blocker.md` with checkboxes and next steps.
  8. Update feature document: Requirements, Acceptance Criteria, Dependencies section, Status and Changelog.
